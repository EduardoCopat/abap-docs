


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.9">
    
    
      
        <title>Abenhier desc agg abexa - ABAP docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.36ee6aaa.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.83bccb1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#4051b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://raw.githubusercontent.com/highlightjs/highlight.js/master/src/styles/github.css">
    
      <link rel="stylesheet" href="../../css/abap-docs.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hierarchy-navigator-hierarchy_descendants_aggregate" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="ABAP docs" class="md-header-nav__button md-logo" aria-label="ABAP docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            ABAP docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Abenhier desc agg abexa
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/eduardocopat/abap-docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    eduardocopat/abap-docs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ABAP docs" class="md-nav__button md-logo" aria-label="ABAP docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ABAP docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/eduardocopat/abap-docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    eduardocopat/abap-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../7.31/abapdata_options/" title="7.31" class="md-nav__link">
      7.31
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#source-code" class="md-nav__link">
    Source Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/eduardocopat/abap-docs/edit/master/docs/7.54/abenhier_desc_agg_abexa.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <p><small>
<a href="../abenabap" class="blue">ABAP Keyword Documentation</a>&#xA0;&#x2192;&#xA0;
<a href="../abenabap_reference" class="blue">ABAP &#x2212; Reference</a>&#xA0;&#x2192;&#xA0;
<a href="../abenabap_language_external_data" class="blue">Processing External Data</a>&#xA0;&#x2192;&#xA0;
<a href="../abenabap_sql" class="blue">ABAP Database Access</a>&#xA0;&#x2192;&#xA0;
<a href="../abenopensql" class="blue">ABAP SQL</a>&#xA0;&#x2192;&#xA0;
<a href="../abenopen_sql_reading" class="blue">ABAP SQL - Reads</a>&#xA0;&#x2192;&#xA0;
<a href="../abenselect_clauses" class="blue">SELECT clauses</a>&#xA0;&#x2192;&#xA0;
<a href="../abapfrom_clause" class="blue">SELECT - FROM</a>&#xA0;&#x2192;&#xA0;
<a href="../abapselect_data_source" class="blue">SELECT - FROM data_source</a>&#xA0;&#x2192;&#xA0;
<a href="../abenselect_hierarchy_data" class="blue">SELECT - FROM hierarchy_data</a>&#xA0;&#x2192;&#xA0;
<a href="../abenselect_hierarchy_navigators" class="blue">SELECT - FROM hierarchy_navigator</a>&#xA0;&#x2192;&#xA0;
<a href="../abenselect_hierarchy_agg_navis" class="blue">SELECT - FROM hierarchy_aggregate_navigator</a>&#xA0;&#x2192;&#xA0;
<a href="../abenselect_hierarchy_desc_agg" class="blue">SELECT - FROM HIERARCHY_DESCENDANTS_AGGREGATE</a>&#xA0;</small></p>
<h1 id="hierarchy-navigator-hierarchy_descendants_aggregate">Hierarchy Navigator HIERARCHY_DESCENDANTS_AGGREGATE</h1>
<p>This example demonstrates the hierarchy navigator <code style="display: inline;"><span class="qtext">HIERARCHY_DESCENDANTS_AGGREGATE</span></code> with the addition <code style="display: inline;"><span class="qtext">JOIN</span></code>.</p>
<p><a name="@@ITOC@@ABENHIER_DESC_AGG_ABEXA_1"></a>
Other versions: 
 <s><i>7.31</i></s> | <s><i>7.40</i></s> | <b>7.54</b></p>
<h2 id="source-code">Source Code</h2>
<p><div class="highlight"><pre><span></span><code>    <span class="k">DATA</span><span class="p">(</span><span class="nv">level</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span><span class="p">.</span>
    <span class="nv">cl_demo_input</span><span class="o">=&gt;</span><span class="nf">request</span><span class="p">(</span> <span class="k">CHANGING</span> <span class="k">field</span> <span class="o">=</span> <span class="nv">level</span> <span class="p">).</span>

    <span class="k">DATA</span> <span class="nv">itab</span> <span class="k">TYPE SORTED TABLE OF</span> <span class="nv">demo_child_num</span>
              <span class="k">WITH NON-UNIQUE KEY</span> <span class="nv">client</span> <span class="k">id</span><span class="p">.</span>

    <span class="nv">fill_table</span><span class="p">(</span> <span class="p">).</span>

    <span class="k">SELECT</span> <span class="k">FROM</span> <span class="nv">demo_cds_parent_child</span><span class="p">(</span> <span class="nv">p_id</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span> <span class="p">)</span>
           <span class="k">FIELDS</span> <span class="k">id</span><span class="p">,</span>
                  <span class="nv">parent</span><span class="p">,</span>
                  <span class="nv">hierARCHY_level</span>
           <span class="k">INTO</span> <span class="k">TABLE</span> <span class="err">@</span><span class="nv">DATA</span><span class="p">(</span><span class="nv">hierarchy</span><span class="p">).</span>
    <span class="nv">cl_demo_output</span><span class="o">=&gt;</span><span class="nf">write</span><span class="p">(</span> <span class="nv">hierarchy</span> <span class="p">).</span>

    <span class="nv">cl_demo_output</span><span class="o">=&gt;</span><span class="nf">line</span><span class="p">(</span> <span class="p">).</span>

    <span class="k">SELECT</span> <span class="k">FROM</span> <span class="nv">demo_cds_parent_child</span><span class="p">(</span> <span class="nv">p_id</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">h</span>
             <span class="nv">LEFT</span> <span class="nv">OUTER</span> <span class="k">JOIN</span> <span class="nv">demo_child_num</span> <span class="k">AS</span> <span class="nv">j</span>
               <span class="k">ON</span> <span class="nv">j~id</span> <span class="o">=</span> <span class="nv">h~id</span>
           <span class="k">FIELDS</span> <span class="nv">h~id</span><span class="p">,</span>
                  <span class="nv">h~parent</span><span class="p">,</span>
                  <span class="nv">j~num</span><span class="p">,</span>
                  <span class="nv">h~hierarchy_level</span>
           <span class="k">INTO</span> <span class="k">TABLE</span> <span class="err">@</span><span class="nv">DATA</span><span class="p">(</span><span class="nv">hierarchy_joined</span><span class="p">).</span>
    <span class="nv">cl_demo_output</span><span class="o">=&gt;</span><span class="nf">write</span><span class="p">(</span> <span class="nv">hierarchy_joined</span> <span class="p">).</span>

    <span class="k">SELECT</span> <span class="nv">agg~</span><span class="o">*</span>
           <span class="k">FROM</span> <span class="nv">HIERARCHY_DESCENDANTS_AGGREGATE</span><span class="p">(</span>
                  <span class="k">SOURCE </span><span class="nv">HIERARCHY</span><span class="p">(</span>
                           <span class="k">SOURCE </span><span class="nv">demo_cds_parent_child_source</span>
                           <span class="nv">CHILD</span> <span class="k">TO</span> <span class="nv">PARENT</span> <span class="nv">ASSOCIATION</span> <span class="nv">_relat</span>
                           <span class="nv">START</span> <span class="k">WHERE</span> <span class="k">id</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
                           <span class="nv">SIBLINGS</span> <span class="k">ORDER BY</span> <span class="k">id</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">h</span>
                  <span class="k">JOIN</span> <span class="nv">demo_child_num</span> <span class="k">AS</span> <span class="nv">j</span>
                    <span class="k">ON</span> <span class="nv">j~id</span> <span class="o">=</span> <span class="nv">h~id</span>
                  <span class="nv">MEASURES</span> <span class="nv">MIN</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">min</span><span class="p">,</span>
                           <span class="nv">MAX</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">max</span><span class="p">,</span>
                           <span class="nv">SUM</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="k">sum</span><span class="p">,</span>
                           <span class="nv">COUNT</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">cnt</span>
                  <span class="k">WHERE</span> <span class="nv">hierarchy_level</span> <span class="o">&lt;=</span> <span class="err">@</span><span class="nv">level</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">agg</span>
           <span class="k">INTO</span> <span class="k">TABLE</span> <span class="err">@</span><span class="nv">DATA</span><span class="p">(</span><span class="nv">asql_hierarchy_desc_aggregate</span><span class="p">).</span>
    <span class="nv">cl_demo_output</span><span class="o">=&gt;</span><span class="nf">write</span><span class="p">(</span> <span class="nv">asql_hierarchy_desc_aggregate</span> <span class="p">).</span>

    <span class="k">SELECT</span> <span class="nv">agg~</span><span class="o">*</span>
           <span class="k">FROM</span> <span class="nv">HIERARCHY_DESCENDANTS_AGGREGATE</span><span class="p">(</span>
                  <span class="k">SOURCE </span><span class="nv">demo_cds_parent_child</span><span class="p">(</span> <span class="nv">p_id</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">h</span>
                  <span class="k">JOIN</span> <span class="nv">demo_child_num</span> <span class="k">AS</span> <span class="nv">j</span>
                    <span class="k">ON</span> <span class="nv">j~id</span> <span class="o">=</span> <span class="nv">h~id</span>
                  <span class="nv">MEASURES</span> <span class="nv">MIN</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">min</span><span class="p">,</span>
                           <span class="nv">MAX</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">max</span><span class="p">,</span>
                           <span class="nv">SUM</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="k">sum</span><span class="p">,</span>
                           <span class="nv">COUNT</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">cnt</span>
                  <span class="k">WHERE</span> <span class="nv">hierarchy_level</span> <span class="o">&lt;=</span> <span class="err">@</span><span class="nv">level</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">agg</span>
           <span class="k">INTO</span> <span class="k">TABLE</span> <span class="err">@</span><span class="nv">DATA</span><span class="p">(</span><span class="nv">cds_hierarchy_desc_aggregate</span><span class="p">).</span>
    <span class="k">ASSERT</span>
      <span class="nv">cds_hierarchy_desc_aggregate</span> <span class="o">=</span> <span class="nv">asql_hierarchy_desc_aggregate</span><span class="p">.</span>

    <span class="nv">cl_demo_output</span><span class="o">=&gt;</span><span class="nf">line</span><span class="p">(</span> <span class="p">).</span>

    <span class="k">SELECT</span> <span class="o">*</span>
           <span class="k">FROM</span> <span class="nv">demo_child_num</span>
           <span class="k">INTO</span> <span class="k">TABLE</span> <span class="err">@</span><span class="nv">itab</span><span class="p">.</span>
    <span class="nv">itab</span> <span class="o">=</span> <span class="k">VALUE</span> <span class="err">#</span><span class="p">(</span> <span class="nv">BASE</span> <span class="nv">itab</span>
      <span class="p">(</span> <span class="nv">client</span> <span class="o">=</span> <span class="nv">sy</span><span class="o">-</span><span class="nv">mandt</span> <span class="k">id</span> <span class="o">=</span> <span class="s1">&#39;A &#39;</span> <span class="nv">num</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>     <span class="p">)</span>
      <span class="p">(</span> <span class="nv">client</span> <span class="o">=</span> <span class="nv">sy</span><span class="o">-</span><span class="nv">mandt</span> <span class="k">id</span> <span class="o">=</span> <span class="s1">&#39;BC&#39;</span> <span class="nv">num</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="p">)</span>
      <span class="p">(</span> <span class="nv">client</span> <span class="o">=</span> <span class="nv">sy</span><span class="o">-</span><span class="nv">mandt</span> <span class="k">id</span> <span class="o">=</span> <span class="s1">&#39;BD&#39;</span> <span class="nv">num</span> <span class="o">=</span> <span class="mi">100000</span> <span class="p">)</span>
      <span class="p">(</span> <span class="nv">client</span> <span class="o">=</span> <span class="nv">sy</span><span class="o">-</span><span class="nv">mandt</span> <span class="k">id</span> <span class="o">=</span> <span class="s1">&#39;BD&#39;</span> <span class="nv">num</span> <span class="o">=</span> <span class="mi">200000</span> <span class="p">)</span>
      <span class="p">(</span> <span class="nv">client</span> <span class="o">=</span> <span class="nv">sy</span><span class="o">-</span><span class="nv">mandt</span> <span class="k">id</span> <span class="o">=</span> <span class="s1">&#39;BD&#39;</span> <span class="nv">num</span> <span class="o">=</span> <span class="mi">300000</span> <span class="p">)</span> <span class="p">).</span>

    <span class="k">SELECT</span> <span class="k">FROM</span> <span class="nv">demo_cds_parent_child</span><span class="p">(</span> <span class="nv">p_id</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">h</span>
             <span class="nv">LEFT</span> <span class="nv">OUTER</span> <span class="k">JOIN</span> <span class="err">@</span><span class="nv">itab</span> <span class="k">AS</span> <span class="nv">j</span>
               <span class="k">ON</span> <span class="nv">j~id</span> <span class="o">=</span> <span class="nv">h~id</span>
           <span class="k">FIELDS</span> <span class="nv">h~id</span><span class="p">,</span>
                  <span class="nv">h~parent</span><span class="p">,</span>
                  <span class="nv">j~num</span><span class="p">,</span>
                  <span class="nv">h~hierarchy_level</span>
           <span class="k">INTO</span> <span class="k">TABLE</span> <span class="err">@</span><span class="nv">hierarchy_joined</span><span class="p">.</span>
    <span class="nv">cl_demo_output</span><span class="o">=&gt;</span><span class="nf">write</span><span class="p">(</span> <span class="nv">hierarchy_joined</span> <span class="p">).</span>

    <span class="k">SELECT</span> <span class="nv">agg~</span><span class="o">*</span>
           <span class="k">FROM</span> <span class="nv">HIERARCHY_DESCENDANTS_AGGREGATE</span><span class="p">(</span>
                  <span class="k">SOURCE </span><span class="nv">HIERARCHY</span><span class="p">(</span>
                           <span class="k">SOURCE </span><span class="nv">demo_cds_parent_child_source</span>
                           <span class="nv">CHILD</span> <span class="k">TO</span> <span class="nv">PARENT</span> <span class="nv">ASSOCIATION</span> <span class="nv">_relat</span>
                           <span class="nv">START</span> <span class="k">WHERE</span> <span class="k">id</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
                           <span class="nv">SIBLINGS</span> <span class="k">ORDER BY</span> <span class="k">id</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">h</span>
                  <span class="k">JOIN</span> <span class="err">@</span><span class="nv">itab</span> <span class="k">AS</span> <span class="nv">j</span>
                    <span class="k">ON</span> <span class="nv">j~id</span> <span class="o">=</span> <span class="nv">h~id</span>
                  <span class="nv">MEASURES</span> <span class="nv">MIN</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">min</span><span class="p">,</span>
                           <span class="nv">MAX</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">max</span><span class="p">,</span>
                           <span class="nv">SUM</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="k">sum</span><span class="p">,</span>
                           <span class="nv">COUNT</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">cnt</span>
                  <span class="k">WHERE</span> <span class="nv">hierarchy_level</span> <span class="o">&lt;=</span> <span class="err">@</span><span class="nv">level</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">agg</span>
           <span class="k">INTO</span> <span class="k">TABLE</span> <span class="err">@</span><span class="nv">asql_hierarchy_desc_aggregate</span><span class="p">.</span>
    <span class="nv">cl_demo_output</span><span class="o">=&gt;</span><span class="nf">write</span><span class="p">(</span> <span class="nv">asql_hierarchy_desc_aggregate</span> <span class="p">).</span>

    <span class="k">SELECT</span> <span class="nv">agg~</span><span class="o">*</span>
           <span class="k">FROM</span> <span class="nv">HIERARCHY_DESCENDANTS_AGGREGATE</span><span class="p">(</span>
                  <span class="k">SOURCE </span><span class="nv">demo_cds_parent_child</span><span class="p">(</span> <span class="nv">p_id</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">h</span>
                  <span class="k">JOIN</span> <span class="err">@</span><span class="nv">itab</span> <span class="k">AS</span> <span class="nv">j</span>
                    <span class="k">ON</span> <span class="nv">j~id</span> <span class="o">=</span> <span class="nv">h~id</span>
                  <span class="nv">MEASURES</span> <span class="nv">MIN</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">min</span><span class="p">,</span>
                           <span class="nv">MAX</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">max</span><span class="p">,</span>
                           <span class="nv">SUM</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="k">sum</span><span class="p">,</span>
                           <span class="nv">COUNT</span><span class="p">(</span> <span class="nv">j~num</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">cnt</span>
                  <span class="k">WHERE</span> <span class="nv">hierarchy_level</span> <span class="o">&lt;=</span> <span class="err">@</span><span class="nv">level</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">agg</span>
           <span class="k">INTO</span> <span class="k">TABLE</span> <span class="err">@</span><span class="nv">cds_hierarchy_desc_aggregate</span><span class="p">.</span>
    <span class="k">ASSERT</span>
      <span class="nv">cds_hierarchy_desc_aggregate</span> <span class="o">=</span> <span class="nv">asql_hierarchy_desc_aggregate</span><span class="p">.</span>

    <span class="k">DELETE</span> <span class="k">FROM</span> <span class="nv">demo_parent_chld</span><span class="p">.</span> <span class="c1">&quot;GTT!</span>
    <span class="k">DELETE</span> <span class="k">FROM</span> <span class="nv">demo_child_num</span><span class="p">.</span>   <span class="c1">&quot;GTT!</span>

    <span class="nv">cl_demo_output</span><span class="o">=&gt;</span><span class="nf">display</span><span class="p">(</span> <span class="p">).</span>
</code></pre></div>
<a name="@@ITOC@@ABENHIER_DESC_AGG_ABEXA_2"></a></p>
<h2 id="description">Description</h2>
<p>Calls the hierarchy navigator <a href="../abenselect_hierarchy_agg_navis" class="blue"><code style="display: inline;"><span class="qtext">HIERARCHY_DESCENDANTS_AGGREGATE</span></code></a> where the
<a href="../abencds_hierarchy_glosry" class="grey" title="Glossary Entry">CDS hierarchy</a> DEMO_CDS_PARENT_CHILD
specified as a source is joined with a database table <span class="lnkgrey">DEMO_CHILD_NUM</span> and
an internal table <a href="../abapselect_itab" class="blue"><code style="display: inline;"><span class="qtext">@itab</span></code></a> using
the addition <code style="display: inline;"><span class="qtext">JOIN</span></code>. The aggregate functions evaluate the column NUM of the joined data sources. The results of the join expressions used are also displayed.</p>
<ul>

<li>In the first part, the table DEMO_CHILD_NUM is filled to produce a 1:1 relationship between the
rows of the hierarchy and its own rows. The result of the hierarchy navigator is the same as in the
executable example <span class="lnkgrey">DEMO_HIERARCHY_AGGREGATE</span>, but here the number values are taken from the joined table.</li>

</ul>

<ul>

<li>In the second part, the internal table <code style="display: inline;"><span class="qtext">@itab</span></code> contains the rows of the
database table DEMO_CHILD_NUM and further rows that also match the criteria for descendant nodes for
nodes of the hierarchy. This example shows how these additional rows, produced in the results set of the join, are evaluated in the aggregate functions.</li>

</ul>

<p>The statement <a href="../abapassert" class="blue"><code style="display: inline;"><span class="qtext">ASSERT</span></code></a> shows that the use of the
<a href="../abenhierarchy_generator_glosry" class="grey" title="Glossary Entry">hierarchy
generator</a> <a href="../abenselect_hierarchy_generator" class="blue"><code style="display: inline;"><span class="qtext">HIERARCHY</span></code></a> and a semantically identical
<a href="../abencds_hierarchy_glosry" class="grey" title="Glossary Entry">CDS hierarchy</a> as the source of the hierarchy navigator produces the same results.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.df0def68.min.js"></script>
      <script src="../../assets/javascripts/bundle.ba57d267.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js"></script>
      
        <script src="../../javascript/hljs.js"></script>
      
    
  </body>
</html>