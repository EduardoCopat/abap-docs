


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.9">
    
    
      
        <title>Abapwith - ABAP docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.36ee6aaa.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.83bccb1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#4051b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://raw.githubusercontent.com/highlightjs/highlight.js/master/src/styles/github.css">
    
      <link rel="stylesheet" href="../../css/abap-docs.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#with" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="ABAP docs" class="md-header-nav__button md-logo" aria-label="ABAP docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            ABAP docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Abapwith
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/eduardocopat/abap-docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    eduardocopat/abap-docs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ABAP docs" class="md-nav__button md-logo" aria-label="ABAP docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ABAP docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/eduardocopat/abap-docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    eduardocopat/abap-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../7.31/abapdata_options/" title="7.31" class="md-nav__link">
      7.31
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#syntax" class="md-nav__link">
    Syntax
  </a>
  
    <nav class="md-nav" aria-label="Syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addition" class="md-nav__link">
    Addition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effect" class="md-nav__link">
    Effect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executable-examples" class="md-nav__link">
    Executable Examples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#addition_1" class="md-nav__link">
    Addition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effect_1" class="md-nav__link">
    Effect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    Continue
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/eduardocopat/abap-docs/edit/master/docs/7.54/abapwith.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <p><small>
<a href="../abenabap" class="blue">ABAP Keyword Documentation</a>&#xA0;&#x2192;&#xA0;
<a href="../abenabap_reference" class="blue">ABAP &#x2212; Reference</a>&#xA0;&#x2192;&#xA0;
<a href="../abenabap_language_external_data" class="blue">Processing External Data</a>&#xA0;&#x2192;&#xA0;
<a href="../abenabap_sql" class="blue">ABAP Database Access</a>&#xA0;&#x2192;&#xA0;
<a href="../abenopensql" class="blue">ABAP SQL</a>&#xA0;&#x2192;&#xA0;
<a href="../abenopen_sql_reading" class="blue">ABAP SQL - Reads</a>&#xA0;</small></p>
<h1 id="with">WITH</h1>
<p><a href="../abapwith_shortref" class="blue">Quick Reference</a>  </p>
<p>Other versions: 
 <s><i>7.31</i></s> | <s><i>7.40</i></s> | <b>7.54</b></p>
<h2 id="syntax">Syntax</h2>
<p><pre><code class="hljs abap abap-docs-syntax-block">
<span class="qtext">WITH <br>&#xA0;&#xA0;+cte1<i class="bn">[</i>( name1, name2, ... )<i class="bn">]</i> AS ( SELECT
<a href="../abapwith_subquery" class="blue">subquery_clauses</a> <i class="bn">[</i><a href="../abapunion" class="blue">UNION ...</a><i class="bn">]</i> ), <br>
&#xA0;&#xA0;&#xA0;&#xA0;<i class="bn">[</i><a href="../abapwith_hierarchy" class="blue">hierarchy</a><i class="bn">]</i> <br>
&#xA0;&#xA0;&#xA0;&#xA0;<i class="bn">[</i><a href="../abapwith_associations" class="blue">associations</a><i class="bn">]</i><i class="bn">[</i>, <br>
&#xA0;&#xA0;+cte2<i class="bn">[</i>( name1, name2, ... )<i class="bn">]</i> AS ( SELECT
<a href="../abapwith_subquery" class="blue">subquery_clauses</a> <i class="bn">[</i><a href="../abapunion" class="blue">UNION ...</a><i class="bn">]</i> ), <br>
&#xA0;&#xA0;&#xA0;&#xA0;<i class="bn">[</i><a href="../abapwith_hierarchy" class="blue">hierarchy</a><i class="bn">]</i> <br>
&#xA0;&#xA0;&#xA0;&#xA0;<i class="bn">[</i><a href="../abapwith_associations" class="blue">associations</a><i class="bn">]</i>, <br>
&#xA0;&#xA0;... <i class="bn">]</i> <br>&#xA0;&#xA0;SELECT <a href="../abapwith_mainquery" class="blue">mainquery_clauses</a> <br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <i class="bn">[</i><a href="../abapunion" class="blue">UNION ...</a><i class="bn">]</i> <br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <a href="../abapinto_clause" class="blue">INTO<i class="bn">|</i>APPENDING</a> target <br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <i class="bn">[</i><a href="../abapselect_up_to_offset" class="blue">UP TO ...<i class="bn">]</i> <i class="bn">[</i>OFFSET ...<i class="bn">]</i></a> <br>
&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <i class="bn">[</i><a href="../abapselect_additions" class="blue">abap_options</a><i class="bn">]</i>. <br>
&#xA0;&#xA0;... <br><i class="bn">[</i>ENDWITH<i class="bn">]</i>.</span> 
</code></pre></p>
<h3 id="addition">Addition</h3>
<p><a href="#!ABAP_ONE_ADD@1@" class="blue"> <code style="display: inline;"><span class="qtext">... ( name1, name2, ... )</span></code> </a>  </p>
<h3 id="effect">Effect</h3>
<p>The <a href="../abenopen_sql_glosry" class="grey" title="Glossary Entry">ABAP SQL</a> keyword <code style="display: inline;"><span class="qtext">WITH</span></code> introduces the definition of
<a href="../abencommon_table_expression_glosry" class="grey" title="Glossary Entry">common table expressions</a> (CTE for short) to be used in a final
<a href="../abenmainquery_glosry" class="grey" title="Glossary Entry">main query</a>. <code style="display: inline;"><span class="qtext">WITH</span></code>
can be used as a standalone statement (as shown here) or after the statement <a href="../abapopen_cursor" class="blue"><code style="display: inline;"><span class="qtext">OPEN CURSOR</span></code></a>.</p>
<p>Each common table expression creates a tabular results set in a
<a href="../abensubquery_glosry" class="grey" title="Glossary Entry">subquery</a>, which can be used
in the subsequent queries of the <code style="display: inline;"><span class="qtext">WITH</span></code> statement as data source <a href="../abapselect_data_source" class="blue">
<code style="display: inline;"><span class="qtext">data_source</span></code></a>. The <code style="display: inline;"><span class="qtext">WITH</span></code> statement consists of the following parts:</p>
<ul>

<li>
A comma-separated list with at least one definition of a common table expression
<br></li>

</ul>

<ul class="circlem2">

<li>Each common table expression has a unique name <code style="display: inline;"><span class="qtext">+cte1</span></code>, <code style="display: inline;"><span class="qtext">+cte2</span></code>,
... . The names <code style="display: inline;"><span class="qtext">cte</span></code> can have a maximum of 30 characters, and can contain
letters, numbers, and underscores. They must start with either a letter or an underscore. Also, the
name must be prefixed with the character <code style="display: inline;"><span class="qtext">+</span></code>. The initial <code style="display: inline;"><span class="qtext">+</span></code> character is part of the name, but cannot stand alone and must not be followed by a number.</li>

</ul>

<ul class="circlem2">

<li>An optional name list (<code style="display: inline;"><span class="qtext">( name1, name2, ... )</span></code>) for the columns of the result set of the common table expression can be specified directly after the name (see below).</li>

</ul>

<ul class="circlem2">

<li>A parenthesized subquery <code style="display: inline;"><span class="qtext">SELECT</span></code> <a href="../abapwith_subquery" class="blue"><span class="qtext">
subquery_clauses</span></a> follows the <code style="display: inline;"><span class="qtext">AS</span></code>. This subquery creates the tabular
results set of the common table expression. The language element <a href="../abapunion" class="blue"><span class="qtext">
UNION</span></a> can be used to combine the results sets of multiple subqueries. In this case, special
rules <a href="../abapunion_clause" class="blue"><code style="display: inline;"><span class="qtext">query_clauses</span></code></a> apply for specifying clauses.</li>

</ul>

<ul>

<li>
A closing main query <code style="display: inline;"><span class="qtext">SELECT</span></code> <a href="../abapwith_mainquery" class="blue"><code style="display: inline;"><span class="qtext">mainquery_clauses</span></code></a>, which can contain the same
<a href="../abenselect_clauses" class="blue">clauses and additions</a> (apart from <a href="../abenwhere_logexp_itab" class="blue">
<code style="display: inline;"><span class="qtext">FOR ALL ENTRIES</span></code></a>) as a standalone <a href="../abapselect" class="blue"><code style="display: inline;"><span class="qtext">SELECT</span></code></a> statement, and works in the same way:
<br></li>

</ul>

<ul class="circlem2">

<li>The results set of the main query is assigned to ABAP data objects according to the <a href="../abapinto_clause" class="blue"><code style="display: inline;"><span class="qtext">INTO</span></code></a> clause.</li>

</ul>

<ul class="circlem2">

<li>As described in <a href="../abapselect" class="blue"><code style="display: inline;"><span class="qtext">SELECT</span></code></a>, a single-
or multirow results set is created and, depending on the target area specified in the <a href="../abapinto_clause" class="blue">
<code style="display: inline;"><span class="qtext">INTO</span></code></a> clause, a <code style="display: inline;"><span class="qtext">SELECT</span></code> loop is either opened or not.</li>

</ul>

<ul class="circlem2">

<li>A <code style="display: inline;"><span class="qtext">SELECT</span></code> loop must close with the <a href="../abapendwith" class="blue"><span class="qtext">
ENDWITH</span></a> statement. <code style="display: inline;"><span class="qtext">ENDWITH</span></code> has exactly the same meaning for <span class="qtext">
WITH ... SELECT</span> that <a href="../abapendselect" class="blue"><code style="display: inline;"><span class="qtext">ENDSELECT</span></code></a>
has for a standalone <a href="../abapselect" class="blue"><code style="display: inline;"><span class="qtext">SELECT</span></code></a> loop.</li>

</ul>

<ul class="circlem2">

<li>In the main query, each of the previously defined common table expressions <code style="display: inline;"><span class="qtext">+cte1</span></code>,
<code style="display: inline;"><span class="qtext">+cte2</span></code>, and so on, can be used as the data source <a href="../abapselect_data_source" class="blue"><code style="display: inline;"><span class="qtext">data_source</span></code></a>.</li>

</ul>

<p>The language element <a href="../abapunion" class="blue"><code style="display: inline;"><span class="qtext">UNION</span></code></a> can be
used to combine the results sets of multiple main queries. In this case, additional rules <a href="../abapunion_clause" class="blue"><code style="display: inline;"><span class="qtext">query_clauses</span></code></a> apply for specifying clauses.</p>
<p>A common table expression defined in the <code style="display: inline;"><span class="qtext">WITH</span></code> statement can be used after
its definition in the subquery of another common table expression and in the main query as the data
source <a href="../abapselect_data_source" class="blue"><code style="display: inline;"><span class="qtext">data_source</span></code></a>.
It cannot be used in its own subquery or in the subqueries of preceding definitions. A common table expression is only known within the current <code style="display: inline;"><span class="qtext">WITH</span></code> statement.</p>
<p>Each common table expression defined in a <code style="display: inline;"><span class="qtext">WITH</span></code> statement must be used at
least once within the <code style="display: inline;"><span class="qtext">WITH</span></code> statement, either in another common table expression or in the main query.  This means that the main query must access at least one common table expression.</p>
<p>The name <code style="display: inline;"><span class="qtext">+cte</span></code> of a common table expression is valid across the full <span class="qtext">
WITH</span> statement. The character <code style="display: inline;"><span class="qtext">+</span></code> is omitted from the name of the substructure
only when a substructure is created as a data source for a common table expression in an inline declaration
with <a href="../abapselect_into_target" class="blue"><code style="display: inline;"><span class="qtext">@DATA(...)</span></code></a> in the <a href="../abapinto_clause" class="blue"><code style="display: inline;"><span class="qtext">INTO</span></code></a> clause.</p>
<p>The results set of a common table expression never has a
<a href="../abenclient_column_glosry" class="grey" title="Glossary Entry">client column</a>. Even if
the client column of a client-specific data source is added explicitly in the subquery to its <span class="qtext">
SELECT</span> list, it does not behave as such in the results set. For this reason, a query of the <span class="qtext">
WITH</span> statement that uses a common table expression as a data source cannot specify the addition
<a href="../abapselect_client" class="blue"><code style="display: inline;"><span class="qtext">USING</span></code></a> or the obsolete addition <a href="../abapselect_client_obsolete" class="blue"><code style="display: inline;"><span class="qtext">CLIENT SPECIFIED</span></code></a> .</p>
<p>The following additions can be used to publish hierarchies and associations for use in the current <code style="display: inline;"><span class="qtext">WITH</span></code> statement:</p>
<ul>

<li>
The addition <a href="../abapwith_hierarchy" class="blue"><code style="display: inline;"><span class="qtext">hierarchy</span></code></a> can be used to publish the common table expression as a
<a href="../abencte_hierarchy_glosry" class="grey" title="Glossary Entry">CTE hierarchy</a>.
</li>
<li>
The addition <a href="../abapwith_associations" class="blue"><code style="display: inline;"><span class="qtext">associations</span></code></a> can be used to do the following:
<br></li>

</ul>

<ul class="circlem2">

<li><a href="../abapwith_associations_using" class="blue">Publish</a> the
<a href="../abencds_association_glosry" class="grey" title="Glossary Entry">CDS associations</a> of a common table expression when
<a href="../abencds_view_glosry" class="grey" title="Glossary Entry">CDS views</a> are accessed.</li>

</ul>

<ul class="circlem2">

<li><a href="../abencte_association_glosry" class="grey" title="Glossary Entry">Define and publish</a> dedicated
<a href="../abencte_association_glosry" class="grey" title="Glossary Entry">CTE associations</a>.</li>

</ul>

<dd>
The associations can be used in <a href="../abenopen_sql_path" class="blue">path expressions</a> of the subsequent queries of the current <code style="display: inline;"><span class="qtext">WITH</span></code> statement.
</dd>

<p><br style="display: block">
<div markdown="span" class="admonition note">
<p class="admonition-title">Notes</p>
<ul></p>
<li>
A common table expression creates a temporary tabular results set, which can be accessed during execution
of the <code style="display: inline;"><span class="qtext">WITH</span></code> statement. Common table expressions can therefore be thought of as temporary views, which only exist for the duration of the database access.
</li>

<li>
Common table expressions can be used whenever subtotals are required in a <code style="display: inline;"><span class="qtext">SELECT</span></code>
statement. ABAP SQL statements are more readable if common table expressions are used, and a common
table expression is always useful if subtotals is required more than once. If required, common table expressions can also perform the tasks of
<a href="../abenglobal_temporary_table_glosry" class="grey" title="Glossary Entry">GTTs</a>.
</li>

<li>
Using common table expressions also provides the option of selecting directly from a subquery <code style="display: inline;"><span class="qtext">SELECT FROM subquery</span></code>, which is not possible in ABAP SQL.
</li>

<li>
The character <code style="display: inline;"><span class="qtext">+</span></code> used as a prefix labels a table expression as a common table
expression, just like the character <code style="display: inline;"><span class="qtext">@</span></code> for host variables. The character <span class="qtext">
+</span> prevents a common table expression from having the same name as a table from the ABAP Dictionary and hence obscuring it.
</li>

<li>
For <code style="display: inline;"><span class="qtext">WITH</span></code> loops that are closed with <code style="display: inline;"><span class="qtext">ENDWITH</span></code>, the
same notes apply as for <a href="../abapselect" class="blue"><code style="display: inline;"><span class="qtext">SELECT</span></code></a> loops. In particular, <code style="display: inline;"><span class="qtext">WITH</span></code> loops should not be nested.
</li>

<li>
The addition <a href="../abapselect_client" class="blue"><code style="display: inline;"><span class="qtext">USING</span></code></a> can be used in the queries of a <code style="display: inline;"><span class="qtext">WITH</span></code> statement, as is usual for client-specific data sources, to switch
<a href="../abenopen_sql_client_handling" class="blue">implicit client handling</a> there.
</li>

<li>
In the main query of the <code style="display: inline;"><span class="qtext">WITH</span></code> statement, if <code style="display: inline;"><span class="qtext">*</span></code>
is specified in the <code style="display: inline;"><span class="qtext">SELECT</span></code> list, this means that there is no unconverted transfer to a work area specified after <a href="../abapinto_clause" class="blue"><code style="display: inline;"><span class="qtext">INTO</span></code></a>.
</li>

<li>
The <code style="display: inline;"><span class="qtext">WITH</span></code> statement bypasses <a href="../abensap_buffering_glosry" class="grey" title="Glossary Entry">table buffering</a>.
</li>

<li>
If the <code style="display: inline;"><span class="qtext">WITH</span></code> statement is used, syntax buffering is executed in the <a href="../abenopensql_strict_mode_751" class="blue">strict mode for Release7.51</a>. <br>
</li>

<p></ul>
</div>
<br style="display: block">
<div markdown="span" class="admonition example">
<p class="admonition-title">Example</p></p>
<p>The results set of the common table expression <code style="display: inline;"><span class="qtext">+cities</span></code> is a list of all cities
that are flown from or to by an airline. The common table expression is used in the main query as the data source of the subquery of the <code style="display: inline;"><span class="qtext">WHERE</span></code> condition.</p>
<p><div class="highlight"><pre><span></span><code><span class="k">DATA</span> <span class="nv">carrid</span> <span class="k">TYPE </span><span class="nv">spfli</span><span class="o">-</span><span class="nv">carrid</span> <span class="k">VALUE</span> <span class="s1">&#39;LH&#39;</span><span class="p">.</span> 
<span class="nv">cl_demo_input</span><span class="o">=&gt;</span><span class="nf">request</span><span class="p">(</span> <span class="k">CHANGING</span> <span class="k">field</span> <span class="o">=</span> <span class="nv">carrid</span> <span class="p">).</span> 

<span class="k">WITH</span> 
  <span class="o">+</span><span class="nv">cities</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span> <span class="nv">cityfrom</span> <span class="k">AS</span> <span class="nv">city</span> 
           <span class="k">FROM</span> <span class="nv">spfli</span> 
           <span class="k">WHERE</span> <span class="nv">carrid</span> <span class="o">=</span> <span class="err">@</span><span class="nv">carrid</span> 
    <span class="nv">UNION</span> <span class="nv">DISTINCT</span> 
    <span class="k">SELECT</span> <span class="nv">cityto</span> <span class="k">AS</span> <span class="nv">city</span> 
           <span class="k">FROM</span> <span class="nv">spfli</span> 
           <span class="k">WHERE</span> <span class="nv">carrid</span> <span class="o">=</span> <span class="err">@</span><span class="nv">carrid</span> <span class="p">)</span> 
  <span class="k">SELECT</span> <span class="o">*</span> 
         <span class="k">FROM</span> <span class="nv">sgeocity</span> 
         <span class="k">WHERE</span> <span class="nv">city</span> <span class="k">IN</span> <span class="p">(</span> <span class="k">SELECT</span> <span class="nv">city</span> 
                               <span class="k">FROM</span> <span class="o">+</span><span class="nv">cities</span> <span class="p">)</span> 
         <span class="k">INTO</span> <span class="k">TABLE</span> <span class="err">@</span><span class="nv">DATA</span><span class="p">(</span><span class="nv">result</span><span class="p">).</span> 

<span class="nv">cl_demo_output</span><span class="o">=&gt;</span><span class="nf">display</span><span class="p">(</span> <span class="nv">result</span> <span class="p">).</span> 
</code></pre></div>
</div></p>
<h3 id="executable-examples">Executable Examples</h3>
<ul>

<li>
<a href="../abenwith_cte_abexa" class="blue"><code style="display: inline;"><span class="qtext">WITH</span></code>, Common Table Expressions</a>
</li>

<li>
<a href="../abenwith_client_handling_abexa" class="blue"><code style="display: inline;"><span class="qtext">WITH</span></code>, Client Handling</a>
</li>

<li>
<a href="../abenwith_agg_union_abexa" class="blue"><code style="display: inline;"><span class="qtext">WITH</span></code>, Aggregation for Join Set</a> <br>
</li>

</ul>

<h3 id="addition_1">Addition</h3>
<p><code style="display: inline;"><span class="qtext">... ( name1, name2, ... )</span></code> <!-- /A -->  <br></p>
<h3 id="effect_1">Effect</h3>
<p>Defines the column names of a common table expression <code style="display: inline;"><span class="qtext">+cte</span></code>. The specified
names <code style="display: inline;"><span class="qtext">name1</span></code>, <code style="display: inline;"><span class="qtext">name2</span></code>, ... are assigned to the columns defined in the <a href="../abapselect_list" class="blue"><code style="display: inline;"><span class="qtext">SELECT</span></code> list</a> of the
<a href="../abapwith_subquery" class="blue">subquery</a> of the common table expression in the order
given. The names work like the alias names defined in the <code style="display: inline;"><span class="qtext">SELECT</span></code> list using <code style="display: inline;"><span class="qtext">AS</span></code> and overwrite these names.</p>
<ul>

<li>
If a name list is specified, it must contain a name for each column of the common table expression.
</li>
<li>
If no name list is specified, the columns of the results list have the names defined in the <a href="../abapselect_list" class="blue"><code style="display: inline;"><span class="qtext">SELECT</span></code> list</a> of the
<a href="../abapwith_subquery" class="blue">subquery</a>.
<br></li>

</ul>

<p>The opening parenthesis must be directly after the name <code style="display: inline;"><span class="qtext">+cte1</span></code>, <code style="display: inline;"><span class="qtext">+cte2</span></code>,
and so on. At least one blank must be placed after the opening parenthesis and before the closing parenthesis. There can be blanks in the comma-separated list of names.</p>
<p>The names can have a maximum of 30 characters, and can contain letters, numbers, and underscores. They must start with either a letter or an underscore.</p>
<p><br style="display: block">
<div markdown="span" class="admonition note">
<p class="admonition-title">Note</p></p>
<p>It is possible to specify a name list if all columns with <code style="display: inline;"><span class="qtext">*</span></code> are selected in the <a href="../abapselect_list" class="blue"><code style="display: inline;"><span class="qtext">SELECT</span></code> list</a> of the
<a href="../abapwith_subquery" class="blue">subquery</a>. This can lead to syntax errors if the data source of the subquery is then extended.</p>
<p></div>
<br style="display: block">
<div markdown="span" class="admonition example">
<p class="admonition-title">Example</p></p>
<p>The results sets of both common table expressions <code style="display: inline;"><span class="qtext">+connections</span></code> and <span class="qtext">
+sum_seats</span> are merged in the subquery of the common table expression <code style="display: inline;"><span class="qtext">+result</span></code>
in a join expression. An explicit name list assigns names to the resulting columns. These names are
used in the main query to sort the results. For each flight connection of the selected airline, the total number of occupied seats is output from the database table SFLIGHT.</p>
<div class="highlight"><pre><span></span><code><span class="k">DATA</span> <span class="nv">from_id</span> <span class="k">TYPE </span><span class="nv">spfli</span><span class="o">-</span><span class="nv">carrid</span> <span class="k">VALUE</span> <span class="s1">&#39;AA&#39;</span><span class="p">.</span> 
<span class="nv">cl_demo_input</span><span class="o">=&gt;</span><span class="nf">add_field</span><span class="p">(</span> <span class="k">CHANGING</span> <span class="k">field</span> <span class="o">=</span> <span class="nv">from_id</span> <span class="p">).</span> 
<span class="k">DATA</span> <span class="nv">to_id</span> <span class="k">TYPE </span><span class="nv">spfli</span><span class="o">-</span><span class="nv">carrid</span> <span class="k">VALUE</span> <span class="s1">&#39;UA&#39;</span><span class="p">.</span> 
<span class="nv">cl_demo_input</span><span class="o">=&gt;</span><span class="nf">request</span><span class="p">(</span> <span class="k">CHANGING</span> <span class="k">field</span> <span class="o">=</span> <span class="nv">to_id</span> <span class="p">).</span> 
<span class="nv">from_id</span> <span class="o">=</span> <span class="nv">to_upper</span><span class="p">(</span> <span class="nv">from_id</span> <span class="p">).</span> 
<span class="nv">to_id</span>   <span class="o">=</span> <span class="nv">to_upper</span><span class="p">(</span> <span class="nv">to_id</span> <span class="p">).</span> 

<span class="k">WITH</span> 
  <span class="o">+</span><span class="nv">connections</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span> <span class="nv">spfli~carrid</span><span class="p">,</span> <span class="nv">carrname</span><span class="p">,</span> <span class="nv">connid</span><span class="p">,</span> <span class="nv">cityfrom</span><span class="p">,</span> <span class="nv">cityto</span> 
           <span class="k">FROM</span> <span class="nv">spfli</span> 
           <span class="nv">INNER</span> <span class="k">JOIN</span> <span class="nv">scarr</span> 
             <span class="k">ON</span> <span class="nv">scarr~carrid</span> <span class="o">=</span> <span class="nv">spfli~carrid</span> 
           <span class="k">WHERE</span> <span class="nv">spfli~carrid</span> <span class="nv">BETWEEN</span> <span class="err">@</span><span class="nv">from_id</span> <span class="ow">AND</span> <span class="err">@</span><span class="nv">to_id</span> <span class="p">),</span> 
  <span class="o">+</span><span class="nv">sum_seats</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span> <span class="nv">carrid</span><span class="p">,</span> <span class="nv">connid</span><span class="p">,</span> <span class="nv">SUM</span><span class="p">(</span> <span class="nv">seatsocc</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">sum_seats</span> 
           <span class="k">FROM</span> <span class="nv">sflight</span> 
           <span class="k">WHERE</span> <span class="nv">carrid</span> <span class="nv">BETWEEN</span> <span class="err">@</span><span class="nv">from_id</span> <span class="ow">AND</span> <span class="err">@</span><span class="nv">to_id</span> 
           <span class="k">GROUP BY</span> <span class="nv">carrid</span><span class="p">,</span> <span class="nv">connid</span> <span class="p">),</span> 
  <span class="o">+</span><span class="nv">result</span><span class="p">(</span> <span class="nv">name</span><span class="p">,</span> <span class="nv">connection</span><span class="p">,</span> <span class="nv">departure</span><span class="p">,</span> <span class="nv">arrival</span><span class="p">,</span> <span class="nv">occupied</span> <span class="p">)</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span> <span class="nv">carrname</span><span class="p">,</span> <span class="nv">c~connid</span><span class="p">,</span> <span class="nv">cityfrom</span><span class="p">,</span> <span class="nv">cityto</span><span class="p">,</span> <span class="nv">sum_seats</span> 
           <span class="k">FROM</span> <span class="o">+</span><span class="nv">connections</span> <span class="k">AS</span> <span class="nv">c</span> 
             <span class="nv">INNER</span> <span class="k">JOIN</span> <span class="o">+</span><span class="nv">sum_seats</span> <span class="k">AS</span> <span class="nv">s</span> 
               <span class="k">ON</span> <span class="nv">c~carrid</span> <span class="o">=</span> <span class="nv">s~carrid</span> <span class="ow">AND</span> 
                  <span class="nv">c~connid</span> <span class="o">=</span> <span class="nv">s~connid</span> <span class="p">)</span> 
  <span class="k">SELECT</span> <span class="o">*</span> 
         <span class="k">FROM</span> <span class="o">+</span><span class="k">result </span>
<span class="k">         ORDER BY</span> <span class="nv">name</span><span class="p">,</span> <span class="nv">connection</span> 
         <span class="k">INTO</span> <span class="k">TABLE</span> <span class="err">@</span><span class="nv">DATA</span><span class="p">(</span><span class="nv">result</span><span class="p">).</span> 

<span class="nv">cl_demo_output</span><span class="o">=&gt;</span><span class="nf">display</span><span class="p">(</span> <span class="nv">result</span> <span class="p">).</span> 
</code></pre></div>

</div>

<h3 id="continue">Continue</h3>
<p><a href="../abapwith_subquery" class="blue">WITH subquery_clauses</a></p>
<p><a href="../abapwith_mainquery" class="blue">WITH - mainquery_clauses</a></p>
<p><a href="../abapwith_hierarchy" class="blue">WITH - HIERARCHY</a></p>
<p><a href="../abapwith_associations" class="blue">WITH - ASSOCIATIONS</a></p>
<p><a href="../abapendwith" class="blue">ENDWITH</a></p>
<p><a href="../abenwith_abexas" class="blue">WITH Examples</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.df0def68.min.js"></script>
      <script src="../../assets/javascripts/bundle.ba57d267.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js"></script>
      
        <script src="../../javascript/hljs.js"></script>
      
    
  </body>
</html>