


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.9">
    
    
      
        <title>Abapwith hierarchy - ABAP docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.36ee6aaa.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.83bccb1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#4051b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://raw.githubusercontent.com/highlightjs/highlight.js/master/src/styles/github.css">
    
      <link rel="stylesheet" href="../../css/abap-docs.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#with-hierarchy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="ABAP docs" class="md-header-nav__button md-logo" aria-label="ABAP docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            ABAP docs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Abapwith hierarchy
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/eduardocopat/abap-docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    eduardocopat/abap-docs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ABAP docs" class="md-nav__button md-logo" aria-label="ABAP docs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ABAP docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/eduardocopat/abap-docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    eduardocopat/abap-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../7.31/abapdata_options/" title="7.31" class="md-nav__link">
      7.31
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#syntax" class="md-nav__link">
    Syntax
  </a>
  
    <nav class="md-nav" aria-label="Syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#effect" class="md-nav__link">
    Effect
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/eduardocopat/abap-docs/edit/master/docs/7.54/abapwith_hierarchy.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <p><small>
<a href="../abenabap" class="blue">ABAP Keyword Documentation</a>&#xA0;&#x2192;&#xA0;
<a href="../abenabap_reference" class="blue">ABAP &#x2212; Reference</a>&#xA0;&#x2192;&#xA0;
<a href="../abenabap_language_external_data" class="blue">Processing External Data</a>&#xA0;&#x2192;&#xA0;
<a href="../abenabap_sql" class="blue">ABAP Database Access</a>&#xA0;&#x2192;&#xA0;
<a href="../abenopensql" class="blue">ABAP SQL</a>&#xA0;&#x2192;&#xA0;
<a href="../abenopen_sql_reading" class="blue">ABAP SQL - Reads</a>&#xA0;&#x2192;&#xA0;
<a href="../abapwith" class="blue">WITH</a>&#xA0;</small></p>
<h1 id="with-hierarchy">WITH - HIERARCHY</h1>
<p><a name="@@ITOC@@ABAPWITH_HIERARCHY_1"></a>
Other versions: 
 <s><i>7.31</i></s> | <s><i>7.40</i></s> | <b>7.54</b></p>
<h2 id="syntax">Syntax</h2>
<p><pre><code class="hljs abap abap-docs-syntax-block">
<span class="qtext">... WITH HIERARCHY hierarchy <br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <i class="bn">|</i> (hierarchy_syntax)</span> 
</code></pre></p>
<h3 id="effect">Effect</h3>
<p>The addition <code style="display: inline;"><span class="qtext">WITH HIERARCHY</span></code> publishes a common table expression as a
<a href="../abencte_hierarchy_glosry" class="grey" title="Glossary Entry">CTE hierarchy</a>. Under
its name, a common table expression like this can be used in the subsequent queries of the current <a href="../abapwith" class="blue">
<code style="display: inline;"><span class="qtext">WITH</span></code></a> statement as a hierarchy <a href="../abenselect_hierarchy" class="blue"><code style="display: inline;"><span class="qtext">hierarchy</span></code></a>.</p>
<p>Only a single data source can be accessed in the subquery of the common table expression and this data
source must be a hierarchy <a href="../abenselect_hierarchy" class="blue"><code style="display: inline;"><span class="qtext">hierarchy</span></code></a>.
The hierarchy used as the data source of the subquery can be specified either statically or dynamically after <code style="display: inline;"><span class="qtext">HIERARCHY</span></code>.</p>
<ul>

<li>
<code style="display: inline;"><span class="qtext">hierarchy</span></code> is used to specify either the name of the hierarchy or its alias name defined using <a href="../abapfrom_clause" class="blue"><code style="display: inline;"><span class="qtext">AS</span></code></a>. When the
<a href="../abenhierarchy_generator_glosry" class="grey" title="Glossary Entry">hierarchy generator</a>
<a href="../abenselect_hierarchy_generator" class="blue"><code style="display: inline;"><span class="qtext">HIERARCHY</span></code></a> is used, it must have an alias name and this name must be specified.
</li>
<li>
A parenthesized data object <code style="display: inline;"><span class="qtext">hierarchy_syntax</span></code> can be specified that, when
the statement is executed, must either contain the static syntax specifying the hierarchy or be initial.
In this case, the common table expression can be used only in other dynamic tokens of the <code style="display: inline;"><span class="qtext">WITH</span></code> statement. The data object <code style="display: inline;"><span class="qtext">hierarchy_syntax</span></code> can be a character-like data object or a
<a href="../abenstandard_table_glosry" class="grey" title="Glossary Entry">standard table</a> with
a character-like row type. The syntax in <code style="display: inline;"><span class="qtext">hierarchy_syntax</span></code>, as in the static
syntax, is not case-sensitive. Invalid syntax raises a handleable exception from the class CX_SY_DYNAMIC_OSQL_ERROR.
If <code style="display: inline;"><span class="qtext">hierarchy_syntax</span></code> is initial, the common table expression is not published as a table expression.
<br></li>

</ul>

<p>The results set of a common table expression published as a CTE hierarchy includes the
<a href="../abenddddl_hierarchy" class="blue">hierarchy columns</a> of the hierarchy specified in the
subquery. The <a href="../abapselect_list" class="blue"><code style="display: inline;"><span class="qtext">SELECT</span></code></a> list of the subquery cannot contain any columns with the same name or alias name as a hierarchy column.</p>
<p><br style="display: block">
<div markdown="span" class="admonition note">
<p class="admonition-title">Note</p></p>
<p>If <code style="display: inline;"><span class="qtext">hierarchy_syntax</span></code> is specified dynamically, it is possible to decide at runtime whether a common table expression is published as a CTE hierarchy.</p>
<p></div>
<br style="display: block">
<div markdown="span" class="admonition example">
<p class="admonition-title">Example</p></p>
<p>Accesses CTE hierarchies in two hierarchy navigators <a href="../abenhierarchy_navigator_glosry" class="grey" title="Glossary Entry">
<code style="display: inline;"><span class="qtext">HIERARCHY_DESCENDANTS</span></code></a> (in the program <span class="lnkgrey">DEMO_HIERARCHY_CTE</span>)
joined in the main query of a <a href="../abapwith" class="blue"><code style="display: inline;"><span class="qtext">WITH</span></code></a> statement using a left outer join. The first CTE hierarchy represents the
<a href="../abencds_hierarchy_glosry" class="grey" title="Glossary Entry">CDS hierarchy</a> DEMO_CDS_PARENT_CHILD accessed in its subquery. The second CTE hierarchy represents the results set of the
<a href="../abenhierarchy_generator_glosry" class="grey" title="Glossary Entry">hierarchy generator</a>
<a href="../abenselect_hierarchy_generator" class="blue"><code style="display: inline;"><span class="qtext">HIERARCHY</span></code></a> used in its subquery. The <code style="display: inline;"><span class="qtext">ON</span></code> condition of the join compares two
<a href="../abenhierarchy_column_glosry" class="grey" title="Glossary Entry">hierarchy columns</a> of the CTE hierarchies. When <span class="lnkgrey">executed</span>, this program demonstrates the result.</p>
<div class="highlight"><pre><span></span><code><span class="k">WITH</span> <span class="o">+</span><span class="nv">hierarchy1</span> <span class="k">AS</span> <span class="p">(</span> 
        <span class="k">SELECT</span> <span class="k">FROM</span> <span class="nv">demo_cds_parent_child</span><span class="p">(</span> <span class="nv">p_id</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span> <span class="p">)</span> 
               <span class="k">FIELDS</span> <span class="k">id</span> <span class="k">AS</span> <span class="nv">id1</span><span class="p">,</span> 
                      <span class="nv">parent</span> <span class="k">AS</span> <span class="nv">parent1</span> <span class="p">)</span> 
        <span class="k">WITH</span> <span class="nv">HIERARCHY</span> <span class="nv">demo_cds_parent_child</span><span class="p">,</span> 
     <span class="o">+</span><span class="nv">hierarchy2</span> <span class="k">AS</span> <span class="p">(</span> 
        <span class="k">SELECT</span> <span class="k">FROM</span> <span class="nv">HIERARCHY</span><span class="p">(</span> <span class="k">SOURCE </span><span class="nv">demo_cds_parent_child_source</span> 
                              <span class="nv">CHILD</span> <span class="k">TO</span> <span class="nv">PARENT</span> <span class="nv">ASSOCIATION</span> <span class="nv">_relat</span> 
                              <span class="nv">START</span> <span class="k">WHERE</span> <span class="k">id</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">hierarchy</span> 
               <span class="k">FIELDS</span> <span class="k">id</span> <span class="k">AS</span> <span class="nv">id2</span><span class="p">,</span> 
                      <span class="nv">parent</span> <span class="k">AS</span> <span class="nv">parent2</span> <span class="p">)</span> 
        <span class="k">WITH</span> <span class="nv">HIERARCHY</span> <span class="nv">hierarchy</span> 
  <span class="k">SELECT</span> <span class="k">FROM</span> <span class="nv">HIERARCHY_DESCENDANTS</span><span class="p">(</span> 
                <span class="nv">SOURCE</span> <span class="o">+</span><span class="nv">hierarchy1</span> 
                <span class="nv">START</span> <span class="k">WHERE</span> <span class="nv">hierarchy_parent_rank</span> <span class="o">=</span> <span class="mi">0</span> 
                <span class="nv">DISTANCE</span> <span class="k">FROM</span> <span class="mi">1</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">h1</span> 
           <span class="nv">LEFT</span> <span class="nv">OUTER</span> <span class="k">JOIN</span> 
             <span class="nv">HIERARCHY_DESCENDANTS</span><span class="p">(</span> 
               <span class="nv">SOURCE</span> <span class="o">+</span><span class="nv">hierarchy2</span> 
               <span class="nv">START</span> <span class="k">WHERE</span> <span class="nv">hierarchy_parent_rank</span> <span class="o">=</span> <span class="mi">0</span> 
               <span class="nv">DISTANCE</span> <span class="k">FROM</span> <span class="mi">1</span> <span class="p">)</span> <span class="k">AS</span> <span class="nv">h2</span> 
                 <span class="k">ON</span> <span class="nv">h1~hierarchy_rank</span> <span class="o">=</span> <span class="nv">h2~hierarchy_rank</span> 
         <span class="k">FIELDS</span> <span class="nv">h1~id1</span><span class="p">,</span> 
                <span class="nv">h2~id2</span><span class="p">,</span> 
                <span class="nv">h1~parent1</span><span class="p">,</span> 
                <span class="nv">h2~parent2</span> 
         <span class="k">INTO</span> <span class="k">TABLE</span> <span class="err">@</span><span class="nv">DATA</span><span class="p">(</span><span class="nv">result</span><span class="p">).</span>
</code></pre></div>

</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.df0def68.min.js"></script>
      <script src="../../assets/javascripts/bundle.ba57d267.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js"></script>
      
        <script src="../../javascript/hljs.js"></script>
      
    
  </body>
</html>